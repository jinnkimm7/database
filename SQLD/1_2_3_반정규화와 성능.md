# 반정규화와 성능

## 반정규화의 정의

- 반정규화(= 역정규화 = Denormalization)

- 정규화된 엔터티, 속성, 관계에 대해 성능 향상을 목적으로 중복, 통합, 분리를 수행하는 데이터 모델링 기법
  - cf)비정규화 : 정규화를 아예 수행하지 않음.

- 특징
  - 테이블, 칼럼, 관계의 반정규화를 종합적으로 고려해야 함.
    - 일반적으로 속성(컬럼)의 중복을 시도함.
  - 과도한 반정규화 -> 데이터 무결성을 침해하게 됨.

## 반정규화의 사전 절차
  1. 반정규화 대상 조사
  2. 다른 방법유도 검토
    - 뷰(View) 생성 : 뷰 자체가 성능 향상을 가져오지는 않음. 신중하게 설계된 뷰를 재사용할 때 성능 향상
    - 클러스터링 : 자주 사용되는 테이블의 데이터를 디스크의 같은 블록에 저장
    - 인덱스의 조정 : 인덱스 추가, 삭제 및 순서 조정
    - 응용 애플리케이션 : 데이터 처리를 위한 로직 변경
  3. 반정규화 적용
    - 테이블 반정규화
    - 속성의 반정규화
    - 관계의 반정규화

## 반정규화 기법
 - 컬럼 반정규화 (가장 흔한 반정규화 기법이다.)
    - 중복컬럼 추가 : 해당 테이블에서 자주 사용하는 칼럼을 중복시킴
    - 파생칼럼 추가 : 질의가 예상되는 값을 미리 계산하여 저장함
    - 이력테이블칼럼 추가 : 이력테이블에 최근값, 종료여부 등의 칼럼을 중복으로 추가
    - PK의 의미적 분리를 위한 칼럼 추가 : 차량번호 "서울 가1234"와 같이 지역 + 일련번호로 구성된 경우
    - 데이터 복구를 위한 칼럼 추가 : 사용자의 실수 또는 응용프로그램의 오류로 인한 데이터 손실 대비

 - 테이블 반정규화
    - 테이블 병합
      - 관계 병합 : 두 테이블의 동시 조회가 많은 경우
    - 테이블 분할
      - 테이블 수직 분할 : 많은 칼럼을 가진 테이블에서 프로세스가 칼럼 유형마다 다르게 발생하는 경우
      - 테이블 수평 분할 : 테이블이 많은 양의 데이터를 가질 것으로 예상되는 경우 -> Partitioning 
    - 테이블 추가
      - 이력테이블 추가 : 가장 최근값을 중복으로 기록한 테이블 생성
      - 부분테이블 추가 : 집중적으로 자주 사용되는 특정 속성들을 추출하여 별도 테이블 구성

 - 관계 반정규화
    - 중복관계 추가 : 조인을 통해 정보 조회가 가능하지만, 조인 경로 단축을 위해 중복관계를 추가함

## 인덱스
  - 검색 속도의 향상을 위한 기술 -> 실제 테이블을 Full Scan하지 않고 인덱스 테이블을 검색
  - 지나치게 많은 인덱스 생성시 시간 및 공간 낭비
  - 인덱스된 필드의 업데이트시 시간 증가
  - 자동생성(PK 또는 Unique 조건) / 수동생성(Create Index 구문)