# 서브쿼리
- SQL문 안에 포함된 SQL문을 서브쿼리라고 한다.
- 서브쿼리는 메인쿼리의 칼럼을 모두 사용할 수 있지만, 메인쿼리는 서브쿼리의 칼럼을 사용할 수 없다.

## 서브쿼리의 종류
- Single Row (단일행)
  - 서브쿼리의 실행 결과로 항상 1건 이하의 행을 반환
  - 단일행 비교 연산자(=, <, <=, >, =>, <>)와 사용

- Multi Row (다중행)
  - 서브쿼리의 실행 결과로 여러 건의 행 반환 가능
  - 다중행 비교 연산자(IN, ALL, ANY, SOME, EXISTS)와 함께 사용

- Single Column (단일칼럼)
  - 서브쿼리의 실행 결과로 하나의 칼럼을 반환

- Multi Column (다중칼럼)
  - 서브쿼리의 실행 결과로 여러 칼럼을 반환
  - 서브쿼리와 메인쿼리의 비교 연산 수행시, 비교하는 칼럼 개수와 위치가 동일해야함

## 단일행 서브쿼리
- 서브쿼리의 결과 건수가 반드시 1건 이하여야 함
  - 결과가 2건 이상이면 런타임 오류 발생

## 다중행 서브쿼리
- 서브쿼리의 결과 건수가 2건 이상일 가능성이 있을 때
- 다중행 비교연산자와 함께 사용
  - 2건 이상일 가능성은 있지만 결과 건수가 우연히 1개인 경우 -> 단일행 비교 연산자도 에러는 발생하지 않음

- IN : 임의의 결과 중 하나만 만족해도 참
- ALL : 결과의 모든 값을 만조해야 하는 조건
- ANY/SOME : 결과의 어느 하나의 값이라도 만족하면 되는 조건 (ANY = SOME)
- EXISTS : 조건을 만족하는 값이 존재하는지 여부를 확인, 조건을 만족하는 건을 하나라도 찾으면 검색 중지 (속도가 빠름), 주로 참/거짓의 판단 용도로 사용됨

## 연관서브 쿼리
- 메인쿼리의 칼럼이 서브쿼리에서 사용된 쿼리
- 메인쿼리가 먼저 수행되고 그 후에 서브쿼리가 수행됨

## 다중칼럼 서브쿼리
- 서브쿼리의 결과로 여러 컬럼이 반영됨

## 스칼라 서브쿼리
- 하나의 값을 반환하는 서브쿼리
  - 단일행, 단일 컬럼
  - 하나의 값을 반환한다는 점에서 함수의 특성을 가짐
  - 공집합을 반환하는 경우 NULL이 대응됨
- 칼럼이 올수 있는 대부분의 곳에서 사용 가능
  - SELECT절, WHERE절, 함수의 인자, ORDER BY절, CASE절, HAVING절 등

## 뷰(View)
- 테이블은 실제로 데이터를 갖고 있지만, 뷰는 실제 데이터를 갖지 않음
- 가상 테이블이라고도 함
- 쿼리에서 뷰가 사용되면 DBMS 내부적으로 질의를 재작성
- CRETAE VIEW문을 통해 VIEW 생성
```sql
CREATE VIEW V_PLAYER_TEAM AS
SELECT P.PLAYER_NAME, P.BACK_NO, P.TEAM_ID, T.TEAM_NAME
FROM PLAYER P INNER JOIN TEAM T
ON P.TEAM_ID = T.TEAM_ID;
-- VIEW를 사용하면 VIEW에 정의된 내용이 REWRITE된다.
```

### 뷰의 장점
- 독립성
  - 테이블 구조 변경시, 뷰만 변경되고 뷰를 사용하는 응용 프로그램은 변경될 필요가 없음
  - 예) 앞에서 PLAYER와 TEAM 테이블이 변경된 경우 -> V_PLAYER_TEAM 뷰가 이에 맞게 변경된다면 응용프로그램은 변경될 필요 없음.
- 편리성
  - 복잡한 질의를 뷰로 생성하여 질의의 가독성을 높임
- 보안성
  - 민감한 정보를 제외하고 뷰를 생성하여, 사용자로부터 정보를 보호할 수 있음

## 인라인 뷰(Inline View)
- FROM절에서 사용되는 서브쿼리
- 실행 순간에만 임시적으로 생성되며 DB에 저장되지 않음
  - 인라인 뷰 = 동적 뷰
  - 일반 뷰 = 정적 뷰
- 인타인 뷰의 `SELECT문에서 정의된 칼럼은 메인 쿼리에서 사용 가능`
  - 일반적으로 서브쿼리에서 정의된 칼럼은 메인 쿼리에서 사용 불가